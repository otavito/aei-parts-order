<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="img/favicon-32x32.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/home.css">
    <title>Parts and components</title>
</head>

<body>
    <header>
        <nav class="cabecalho">
            <div id="logo">
                <img src="img/logo-aei.png" alt="AEI logo">
            </div>
            <div id="botoes">
                <a href="cart.html">
                    <div class="carrinho">
                        <p>Shopping cart</p>
                        <img src="img/cart.png" alt="">
                    </div>
                </a>
                <a href="https://www.automatedenvironments.com" target="_blank"> <button>Visit our oficial site</button>
                </a>
            </div>
        </nav>
    </header>

    <main>
        <section class="introducao">
            <h1>Parts ordering</h1>
            <p>Welcome to our Parts Ordering page! Please select the AEI parts and components you would like to order.
                Once your order is submitted, you will receive a confirmation email. One of our team members will then
                contact you with the final details.</p>

            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for parts or components...">
            </div>

        </section>

        <section class="produtos" id="produtos"></section>
        <div class="botao-carrinho">
            <a href="cart.html" class="btn-cart" id="btn-finish-order">Finish order</a>
        </div>

        <p
            style="background-color: #2B89ED; color: white; padding: 1rem; border-radius: 7px; font-weight: bold; text-align: center;">
            Could not find what you were looking for? For obsolete parts and components, reach out to
            aei.parts@munters.com
        </p>

    </main>

    <footer>
        <div class="footer-text">
            <h3 style="margin: 10px 0px;">Having trouble with one of our products? </h6>
            <p>We look forward to helping you! Visit our dedicated <b>Help Center</b> for guidance.<br>
            If you canâ€™t find a solution there, feel free to open a support ticket.<br> Our team will be happy to assist you!</p>
            <a href="https://munters-aei.zendesk.com/hc/en-us" target="_blank"> <button>Go to Help Center</button></a>
        </div>
        <div class="footer-logo">
            <img src="/img/zendesk.png" alt="">
        </div>
    </footer>

</body>

<script>
    async function carregarProdutos() {
        try {
            const categoriasResponse = await fetch("js/categories.json");
            const produtosResponse = await fetch("js/products.json");

            const categorias = await categoriasResponse.json();
            const produtos = await produtosResponse.json();

            const container = document.getElementById("produtos");

            categorias.forEach(categoria => {

                const categoriaDiv = document.createElement("div");
                categoriaDiv.classList.add("categoria");

                const header = document.createElement("button");
                header.classList.add("categoria-header");
                header.textContent = categoria.Title;

                const content = document.createElement("div");
                content.classList.add("categoria-content");

                const produtosDaCategoria = produtos.filter(p => p.ProductCategory === categoria.Title);

                produtosDaCategoria.forEach(prod => {
                    const produtoDiv = document.createElement("div");
                    produtoDiv.classList.add("produto");

                    produtoDiv.innerHTML = `
                    <span>${prod.Title}</span>
                    <div class="contador">
                        <button class="menos">-</button>
                        <input type="number" value="0" min="0" readonly>
                        <button class="mais">+</button>
                    </div>
                `;

                    const menos = produtoDiv.querySelector(".menos");
                    const mais = produtoDiv.querySelector(".mais");
                    const input = produtoDiv.querySelector("input");

                    menos.addEventListener("click", () => {
                        if (parseInt(input.value) > 0) {
                            input.value = parseInt(input.value) - 1;
                        }
                        verificarCarrinhoAtivo();
                    });

                    mais.addEventListener("click", () => {
                        input.value = parseInt(input.value) + 1;
                        verificarCarrinhoAtivo();
                    });


                    content.appendChild(produtoDiv);
                });

                header.addEventListener("click", () => {
                    content.classList.toggle("ativo");
                });

                categoriaDiv.appendChild(header);
                categoriaDiv.appendChild(content);
                container.appendChild(categoriaDiv);
            });

        } catch (error) {
            console.error("Error on loading products:", error);
        }
    }

    document.getElementById("btn-finish-order").addEventListener("click", (e) => {
        e.preventDefault();

        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || {};

        document.querySelectorAll(".produto").forEach(produtoDiv => {
            const nome = produtoDiv.querySelector("span").textContent;
            const quantidade = parseInt(produtoDiv.querySelector("input").value);

            if (quantidade > 0) {
                carrinho[nome] = (carrinho[nome] || 0) + quantidade;
            } else if (carrinho[nome]) {
            }
        });

        localStorage.setItem("carrinho", JSON.stringify(carrinho));

        window.location.href = "cart.html";
    });

    function atualizarCarrinho(produto, quantidade) {
        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || {};

        if (quantidade > 0) {
            carrinho[produto] = quantidade;
        } else {
            delete carrinho[produto];
        }

        localStorage.setItem("carrinho", JSON.stringify(carrinho));
    }

    function verificarCarrinhoAtivo() {
        let algumSelecionado = false;

        document.querySelectorAll(".produto input").forEach(input => {
            if (parseInt(input.value) > 0) {
                algumSelecionado = true;
            }
        });

        const btn = document.getElementById("btn-finish-order");
        if (algumSelecionado) {
            btn.classList.remove("hidden");
        } else {
            btn.classList.add("hidden");
        }
    }

    const searchInput = document.getElementById("searchInput");

    searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();

        document.querySelectorAll(".categoria").forEach(categoriaDiv => {
            const produtos = categoriaDiv.querySelectorAll(".produto");
            const content = categoriaDiv.querySelector(".categoria-content");

            if (query === "") {

                produtos.forEach(produtoDiv => produtoDiv.style.display = "flex");
                content.classList.remove("ativo");
                return;
            }

            let temResultado = false;

            produtos.forEach(produtoDiv => {
                const nome = produtoDiv.querySelector("span").textContent.toLowerCase();
                if (nome.includes(query)) {
                    produtoDiv.style.display = "flex";
                    temResultado = true;
                } else {
                    produtoDiv.style.display = "none";
                }
            });

            if (temResultado) {
                content.classList.add("ativo");
            } else {
                content.classList.remove("ativo");
            }
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        carregarProdutos().then(() => verificarCarrinhoAtivo());
    });

</script>

</html>